<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Cifrador Formal Blindado</title>

<style>
/* Estilo general de la página */
body{
    font-family: Arial;
    background:#0f172a;
    color:white;
    display:flex;
    justify-content:center;
    padding:40px;
}

/* Caja principal que contiene toda la aplicación */
.container{
    background:#1e293b;
    padding:30px;
    border-radius:12px;
    width:750px;
}

/* Área donde el usuario escribe el texto */
textarea{
    width:100%;
    height:100px;
    margin:10px 0;
    padding:10px;
    border-radius:6px;
    border:none;
}

/* Selectores y campos de entrada */
select,input{
    width:100%;
    padding:8px;
    margin:5px 0;
    border-radius:6px;
    border:none;
}

/* Botones principales */
button{
    width:100%;
    padding:10px;
    margin:6px 0;
    border:none;
    border-radius:6px;
    background:#3b82f6;
    color:white;
    font-weight:bold;
    cursor:pointer;
}

button:hover{
    background:#2563eb;
}

/* Cuando un botón está deshabilitado */
button:disabled{
    background:gray;
    cursor:not-allowed;
}

/* Área donde se muestran resultados */
.resultado{
    background:#0f172a;
    padding:10px;
    border-radius:6px;
    margin-top:10px;
    white-space:pre-line;
}

/* Mensajes de advertencia */
.advertencia{
    color:#f87171;
    font-size:14px;
}
</style>
</head>
<body>

<div class="container">

<h2>Cifrador César y Atbash</h2>

<!-- Campo donde el usuario escribe el texto -->
<label>Texto:</label>
<textarea id="texto"></textarea>

<!-- Selector para elegir qué conjunto de caracteres se usará -->
<label>Seleccionar conjunto:</label>
<select id="tipoConjunto" onchange="actualizarConjunto()">
    <option value="ascii">ASCII completo (32–126)</option>
    <option value="letras">Solo letras (A-Z a-z)</option>
    <option value="alfaNum">Letras + números</option>
    <option value="personalizado">Personalizado</option>
</select>

<!-- Campo para que el usuario escriba su propio conjunto -->
<input type="text" id="conjuntoPersonalizado"
placeholder="Escribe tu conjunto aquí" disabled>

<!-- Mensaje que aparece si hay algún problema con el conjunto -->
<div class="advertencia" id="mensajeConjunto"></div>

<!-- Campo donde se define el número de desplazamiento del César -->
<label>Módulo (César):</label>
<input type="number" id="modulo" value="1">

<!-- Botones principales -->
<button id="btnCesar" onclick="toggleCesar()">César Cifrar/Descifrar</button>
<button id="btnAtbash" onclick="toggleAtbash()">Atbash Cifrar/Descifrar</button>
<button id="btnDetectar" onclick="detectar()">Detectar tipo</button>

<!-- Aquí se muestran los posibles resultados -->
<div class="resultado" id="resultado"></div>

</div>

<script>

/*
Esta función crea el conjunto ASCII completo.
Incluye todos los caracteres imprimibles del 32 al 126.
Será el conjunto por defecto.
*/
function generarASCII(){
    let ascii="";
    for(let i=32;i<=126;i++){
        ascii+=String.fromCharCode(i);
    }
    return ascii;
}

/*
"conjunto" guarda los caracteres que se usarán para cifrar.
Por defecto empieza con ASCII completo.
*/
let conjunto = generarASCII();

/*
Esta variable nos ayuda a saber si el texto ya fue cifrado
con César para poder descifrarlo al presionar nuevamente.
*/
let cesarActivo = false;

/*
Valida que el conjunto tenga al menos 2 caracteres.
Si no los tiene, desactiva los botones porque no se puede cifrar.
También ajusta automáticamente los límites del módulo.
*/
function validarConjunto(){

    let tamaño = conjunto.length;
    let inputModulo = document.getElementById("modulo");
    let mensaje = document.getElementById("mensajeConjunto");

    let btnCesar = document.getElementById("btnCesar");
    let btnAtbash = document.getElementById("btnAtbash");
    let btnDetectar = document.getElementById("btnDetectar");

    if(tamaño < 2){

        inputModulo.value = 0;
        inputModulo.min = 0;
        inputModulo.max = 0;

        btnCesar.disabled = true;
        btnAtbash.disabled = true;
        btnDetectar.disabled = true;

        mensaje.innerText = "El conjunto debe tener al menos 2 caracteres.";

    }else{

        inputModulo.min = 1;
        inputModulo.max = tamaño - 1;

        if(inputModulo.value < 1) inputModulo.value = 1;
        if(inputModulo.value > tamaño - 1) inputModulo.value = tamaño - 1;

        btnCesar.disabled = false;
        btnAtbash.disabled = false;
        btnDetectar.disabled = false;

        mensaje.innerText = "";
    }
}

/*
Actualiza el conjunto dependiendo de la opción elegida.
Si es personalizado, habilita el campo para escribir.
*/
function actualizarConjunto(){
    let tipo = document.getElementById("tipoConjunto").value;
    let inputPersonal = document.getElementById("conjuntoPersonalizado");

    if(tipo === "ascii"){
        conjunto = generarASCII();
        inputPersonal.disabled = true;
    }
    else if(tipo === "letras"){
        conjunto = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";
        inputPersonal.disabled = true;
    }
    else if(tipo === "alfaNum"){
        conjunto = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";
        inputPersonal.disabled = true;
    }
    else{
        inputPersonal.disabled = false;
        conjunto = inputPersonal.value;
    }

    cesarActivo = false;
    validarConjunto();
}

/*
Si el usuario escribe un conjunto personalizado,
esta parte elimina caracteres repetidos automáticamente.
*/
document.getElementById("conjuntoPersonalizado")
.addEventListener("input", function(){

    if(document.getElementById("tipoConjunto").value === "personalizado"){
        let limpio = [...new Set(this.value)].join('');
        this.value = limpio;
        conjunto = limpio;
        cesarActivo = false;
        validarConjunto();
    }
});

/*
Controla que el módulo esté dentro de los límites válidos.
*/
document.getElementById("modulo")
.addEventListener("input", function(){
    let tamaño = conjunto.length;
    let valor = parseInt(this.value);

    if(tamaño < 2){
        this.value = 0;
        return;
    }

    if(isNaN(valor) || valor < 1) valor = 1;
    if(valor > tamaño - 1) valor = tamaño - 1;

    this.value = valor;
});

/*
Cifrado César:
Desplaza cada carácter según el módulo elegido.
Si un carácter no pertenece al conjunto, se deja igual.
*/
function cifradoCesar(texto, desplazamiento){
    let resultado="";
    let tamaño=conjunto.length;

    for(let i=0;i<texto.length;i++){
        let indice=conjunto.indexOf(texto[i]);

        if(indice!==-1){
            let nuevo=(indice+desplazamiento)%tamaño;
            resultado+=conjunto[nuevo];
        }else{
            resultado+=texto[i];
        }
    }
    return resultado;
}

/*
Este botón permite cifrar y descifrar usando César.
Si ya está cifrado, lo revierte.
*/
function toggleCesar(){
    let textoArea=document.getElementById("texto");
    let texto=textoArea.value;
    let modulo=parseInt(document.getElementById("modulo").value);

    if(!cesarActivo){
        textoArea.value=cifradoCesar(texto,modulo);
        cesarActivo=true;
    }else{
        textoArea.value=cifradoCesar(texto,conjunto.length - modulo);
        cesarActivo=false;
    }
}

/*
Cifrado Atbash:
Intercambia cada carácter por su "opuesto" dentro del conjunto.
*/
function cifradoAtbash(texto){
    let resultado="";
    let tamaño=conjunto.length;

    for(let i=0;i<texto.length;i++){
        let indice=conjunto.indexOf(texto[i]);

        if(indice!==-1){
            resultado+=conjunto[tamaño-1-indice];
        }else{
            resultado+=texto[i];
        }
    }
    return resultado;
}

/*
Aplica Atbash directamente al texto actual.
*/
function toggleAtbash(){
    let textoArea=document.getElementById("texto");
    textoArea.value=cifradoAtbash(textoArea.value);
}

/*
Esta función intenta determinar si el texto tiene
estructura similar al español.
Suma puntos si encuentra letras comunes,
vocales y palabras frecuentes.
*/
function puntuarTexto(texto){

    let puntuacion = 0;
    let textoLower = texto.toLowerCase();

    let letrasFrecuentes = "eaosnrldtu";
    let vocales = "aeiou";

    for(let i = 0; i < textoLower.length; i++){

        let c = textoLower[i];

        if(letrasFrecuentes.includes(c)) puntuacion += 2;
        if(vocales.includes(c)) puntuacion += 1;
        if(c === " ") puntuacion += 4;
        if(/[^\w\s]/.test(c)) puntuacion -= 1;
    }

    let palabrasComunes = [" el ", " la ", " de ", " que ", " y ", " en ", " los ", " del "];

    palabrasComunes.forEach(palabra=>{
        if(textoLower.includes(palabra)){
            puntuacion += 8;
        }
    });

    return puntuacion;
}

/*
Detecta automáticamente si el texto fue cifrado
con César o Atbash.
Prueba todos los desplazamientos posibles y muestra
los 3 resultados más probables.
*/
function detectar(){
    let texto=document.getElementById("texto").value;
    let mejores=[];

    for(let i=1;i<conjunto.length;i++){
        let intento=cifradoCesar(texto,(conjunto.length - i));
        let score=puntuarTexto(intento);

        mejores.push({
            tipo:"César",
            modulo:i,
            resultado:intento,
            puntuacion:score
        });
    }

    let atbashResultado=cifradoAtbash(texto);
    let atbashScore=puntuarTexto(atbashResultado);

    mejores.push({
        tipo:"Atbash",
        modulo:"-",
        resultado:atbashResultado,
        puntuacion:atbashScore
    });

    mejores.sort((a,b)=>b.puntuacion-a.puntuacion);

    let top3=mejores.slice(0,3);

    let salida="Resultados más probables:\n\n";

    top3.forEach((item,index)=>{
        salida+=(index+1)+") "+item.tipo;

        if(item.tipo==="César"){
            salida+=" (Módulo "+item.modulo+")";
        }

        salida+="\n"+item.resultado+"\n\n";
    });

    document.getElementById("resultado").innerText=salida;
}

/* Validación inicial al cargar la página */
validarConjunto();

</script>

</body>
</html>
